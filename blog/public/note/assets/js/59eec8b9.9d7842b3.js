"use strict";(self.webpackChunknote=self.webpackChunknote||[]).push([[9e3],{4137:(t,n,e)=>{e.d(n,{Zo:()=>c,kt:()=>h});var o=e(7294);function a(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function r(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,o)}return e}function i(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?r(Object(e),!0).forEach((function(n){a(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):r(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}function s(t,n){if(null==t)return{};var e,o,a=function(t,n){if(null==t)return{};var e,o,a={},r=Object.keys(t);for(o=0;o<r.length;o++)e=r[o],n.indexOf(e)>=0||(a[e]=t[e]);return a}(t,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(o=0;o<r.length;o++)e=r[o],n.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(t,e)&&(a[e]=t[e])}return a}var l=o.createContext({}),d=function(t){var n=o.useContext(l),e=n;return t&&(e="function"==typeof t?t(n):i(i({},n),t)),e},c=function(t){var n=d(t.components);return o.createElement(l.Provider,{value:n},t.children)},g="mdxType",u={inlineCode:"code",wrapper:function(t){var n=t.children;return o.createElement(o.Fragment,{},n)}},m=o.forwardRef((function(t,n){var e=t.components,a=t.mdxType,r=t.originalType,l=t.parentName,c=s(t,["components","mdxType","originalType","parentName"]),g=d(e),m=a,h=g["".concat(l,".").concat(m)]||g[m]||u[m]||r;return e?o.createElement(h,i(i({ref:n},c),{},{components:e})):o.createElement(h,i({ref:n},c))}));function h(t,n){var e=arguments,a=n&&n.mdxType;if("string"==typeof t||a){var r=e.length,i=new Array(r);i[0]=m;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=t,s[g]="string"==typeof t?t:a,i[1]=s;for(var d=2;d<r;d++)i[d]=e[d];return o.createElement.apply(null,i)}return o.createElement.apply(null,e)}m.displayName="MDXCreateElement"},9939:(t,n,e)=>{e.r(n),e.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>d});var o=e(7462),a=(e(7294),e(4137));const r={id:"frida-java-encryption-algorithm",slug:"/frida-java-encryption-algorithm",title:"Frida java\u5c42\u81ea\u5410\u52a0\u5bc6\u7b97\u6cd5",date:new Date("2021-02-10T00:00:00.000Z"),authors:"kuizuo",tags:["frida","app","hook"],keywords:["frida","app","hook"]},i=void 0,s={unversionedId:"skill/reverse/android/frida/frida-java-encryption-algorithm",id:"skill/reverse/android/frida/frida-java-encryption-algorithm",title:"Frida java\u5c42\u81ea\u5410\u52a0\u5bc6\u7b97\u6cd5",description:"\u4ee3\u7801",source:"@site/docs/skill/reverse/android/frida/Frida java\u5c42\u81ea\u5410\u52a0\u5bc6\u7b97\u6cd5.md",sourceDirName:"skill/reverse/android/frida",slug:"/frida-java-encryption-algorithm",permalink:"/note/frida-java-encryption-algorithm",draft:!1,tags:[{label:"frida",permalink:"/note/tags/frida"},{label:"app",permalink:"/note/tags/app"},{label:"hook",permalink:"/note/tags/hook"}],version:"current",frontMatter:{id:"frida-java-encryption-algorithm",slug:"/frida-java-encryption-algorithm",title:"Frida java\u5c42\u81ea\u5410\u52a0\u5bc6\u7b97\u6cd5",date:"2021-02-10T00:00:00.000Z",authors:"kuizuo",tags:["frida","app","hook"],keywords:["frida","app","hook"]},sidebar:"skill",previous:{title:"Frida Python\u5e93\u4f7f\u7528",permalink:"/note/frida-python-usage"},next:{title:"Frida so\u5c42\u4e2d\u7684hook",permalink:"/note/frida-so-hook"}},l={},d=[{value:"\u4ee3\u7801",id:"\u4ee3\u7801",level:2}],c={toc:d},g="wrapper";function u(t){let{components:n,...e}=t;return(0,a.kt)(g,(0,o.Z)({},c,e,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"\u4ee3\u7801"},"\u4ee3\u7801"),(0,a.kt)("p",null,"\u9488\u5bf9 java \u5c42\u52a0\u5bc6\u7b97\u6cd5\uff0c\u80fd hook \u5230 java \u81ea\u5e26\u7684\u52a0\u5bc6\u51fd\u6570\u5e93"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"const config = {\n  showStacks: false,\n  showDivider: true,\n}\n\nJava.perform(function () {\n  // console.log('frida \u5df2\u542f\u52a8');\n  function showStacks(name = '') {\n    if (config.showStacks) {\n      console.log(Java.use('android.util.Log').getStackTraceString(Java.use('java.lang.Throwable').$new(name)))\n    }\n  }\n\n  function showDivider(name = '') {\n    if (config.showDivider) {\n      console.log(`==============================${name}==============================`)\n    }\n  }\n\n  function showArguments() {\n    console.log('arguments: ', ...arguments)\n  }\n\n  const ByteString = Java.use('com.android.okhttp.okio.ByteString')\n  const Encode = {\n    toBase64(tag, data) {\n      console.log(tag + ' Base64: ', ByteString.of(data).base64())\n      // console.log(tag + ' Base64: ', bytesToBase64(data));\n    },\n    toHex(tag, data) {\n      console.log(tag + ' Hex: ', ByteString.of(data).hex())\n      // console.log(tag + ' Hex: ', bytesToHex(data));\n    },\n    toUtf8(tag, data) {\n      console.log(tag + ' Utf8: ', ByteString.of(data).utf8())\n      // console.log(tag + ' Utf8: ', bytesToString(data));\n    },\n    toAll(tag, data) {\n      Encode.toUtf8(tag, data)\n      Encode.toHex(tag, data)\n      Encode.toBase64(tag, data)\n    },\n    toResult(tag, data) {\n      Encode.toHex(tag, data)\n      Encode.toBase64(tag, data)\n    },\n  }\n\n  const MessageDigest = Java.use('java.security.MessageDigest')\n  {\n    let overloads_update = MessageDigest.update.overloads\n    for (const overload of overloads_update) {\n      overload.implementation = function () {\n        const algorithm = this.getAlgorithm()\n        showDivider(algorithm)\n        showStacks(algorithm)\n        Encode.toAll(`${algorithm} update data`, arguments[0])\n        return this.update(...arguments)\n      }\n    }\n\n    let overloads_digest = MessageDigest.digest.overloads\n    for (const overload of overloads_digest) {\n      overload.implementation = function () {\n        const algorithm = this.getAlgorithm()\n        showDivider(algorithm)\n        showStacks(algorithm)\n        const result = this.digest(...arguments)\n        if (arguments.length === 1) {\n          Encode.toAll(`${algorithm} update data`, arguments[0])\n        } else if (arguments.length === 3) {\n          Encode.toAll(`${algorithm} update data`, arguments[0])\n        }\n\n        Encode.toResult(`${algorithm} digest result`, result)\n        return result\n      }\n    }\n  }\n\n  const Mac = Java.use('javax.crypto.Mac')\n  {\n    Mac.init.overload('java.security.Key', 'java.security.spec.AlgorithmParameterSpec').implementation = function (key, AlgorithmParameterSpec) {\n      return this.init(key, AlgorithmParameterSpec)\n    }\n    Mac.init.overload('java.security.Key').implementation = function (key) {\n      const algorithm = this.getAlgorithm()\n      showDivider(algorithm)\n      showStacks(algorithm)\n      const keyBytes = key.getEncoded()\n      Encode.toAll(`${algorithm} init Key`, keyBytes)\n      return this.init(...arguments)\n    }\n\n    // let overloads_update = Mac.update.overloads;\n    // for (const overload of overloads_update) {\n    //   overload.implementation = function () {\n    //     const algorithm = this.getAlgorithm();\n    //     showDivider(algorithm);\n    //     showStacks(algorithm);\n    //     Encode.toAll(`${algorithm} update data`, arguments[0]);\n    //     return this.update(...arguments);\n    //   };\n    // }\n\n    let overloads_doFinal = Mac.doFinal.overloads\n    for (const overload of overloads_doFinal) {\n      overload.implementation = function () {\n        const algorithm = this.getAlgorithm()\n        showDivider(algorithm)\n        showStacks(algorithm)\n        const result = this.doFinal(...arguments)\n        if (arguments.length === 1) {\n          Encode.toAll(`${algorithm} update data`, arguments[0])\n        } else if (arguments.length === 3) {\n          Encode.toAll(`${algorithm} update data`, arguments[0])\n        }\n\n        Encode.toResult(`${algorithm} doFinal result`, result)\n        return result\n      }\n    }\n  }\n\n  const Cipher = Java.use('javax.crypto.Cipher')\n  {\n    let overloads_init = Cipher.init.overloads\n    for (const overload of overloads_init) {\n      overload.implementation = function () {\n        const algorithm = this.getAlgorithm()\n        showDivider(algorithm)\n        showStacks(algorithm)\n\n        if (arguments[0]) {\n          const mode = arguments[0]\n          console.log(`${algorithm} init mode`, mode)\n        }\n\n        if (arguments[1]) {\n          const className = JSON.stringify(arguments[1])\n          // \u5b89\u535310\u4ee5\u4e0a\u79c1\u94a5\u662f\u6709\u53ef\u80fd\u8f93\u51fa\u4e0d\u4e86\u7684\n          if (className.includes('OpenSSLRSAPrivateKey')) {\n            // const keyBytes = arguments[1];\n            // console.log(`${algorithm} init key`, keyBytes);\n          } else {\n            const keyBytes = arguments[1].getEncoded()\n            Encode.toAll(`${algorithm} init key`, keyBytes)\n          }\n        }\n\n        if (arguments[2]) {\n          const className = JSON.stringify(arguments[2])\n          if (className.includes('javax.crypto.spec.IvParameterSpec')) {\n            const iv = Java.cast(arguments[2], Java.use('javax.crypto.spec.IvParameterSpec'))\n            const ivBytes = iv.getIV()\n            Encode.toAll(`${algorithm} init iv`, ivBytes)\n          } else if (className.includes('java.security.SecureRandom')) {\n          }\n        }\n\n        return this.init(...arguments)\n      }\n    }\n\n    // let overloads_update = Cipher.update.overloads;\n    // for (const overload of overloads_update) {\n    //   overload.implementation = function () {\n    //     const algorithm = this.getAlgorithm();\n    //     showDivider(algorithm);\n    //     showStacks(algorithm);\n    //     Encode.toAll(`${algorithm} update data`, arguments[0]);\n    //     return this.update(...arguments);\n    //   };\n    // }\n\n    let overloads_doFinal = Cipher.doFinal.overloads\n    for (const overload of overloads_doFinal) {\n      overload.implementation = function () {\n        const algorithm = this.getAlgorithm()\n        showDivider(algorithm)\n        showStacks(algorithm)\n        const result = this.doFinal(...arguments)\n        if (arguments.length === 1) {\n          Encode.toAll(`${algorithm} update data`, arguments[0])\n        } else if (arguments.length === 3) {\n          Encode.toAll(`${algorithm} update data`, arguments[0])\n        }\n\n        Encode.toResult(`${algorithm} doFinal result`, result)\n        return result\n      }\n    }\n  }\n\n  const Signature = Java.use('java.security.Signature')\n  {\n    let overloads_update = Signature.update.overloads\n    for (const overload of overloads_update) {\n      overload.implementation = function () {\n        const algorithm = this.getAlgorithm()\n        showDivider(algorithm)\n        showStacks(algorithm)\n        Encode.toAll(`${algorithm} update data`, arguments[0])\n        return this.update(...arguments)\n      }\n    }\n\n    let overloads_sign = Signature.sign.overloads\n    for (const overload of overloads_sign) {\n      overload.implementation = function () {\n        const algorithm = this.getAlgorithm()\n        showDivider(algorithm)\n        showStacks(algorithm)\n        const result = this.sign()\n        Encode.toResult(`${algorithm} sign result`, result)\n        return this.sign(...arguments)\n      }\n    }\n  }\n})\n")))}u.isMDXComponent=!0}}]);